{"version":3,"file":"keenio-lazy.min.js","sources":["../src/keenio-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Segment tracker.\n *\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\nfunction($, Log) {\n\n    var self = this;\n\n    var tracker = {};\n\n    self.addKeenIO = function() {\n        var dfd = $.Deferred();\n        var writeKey = tracker.trackerInfo.writeKey, projectId = tracker.trackerInfo.projectId;\n        if (!writeKey || !projectId) {\n            Log.debug('Liquidus is misconfigured for keen.io, Write Key or Project ID are missing.');\n            return;\n        }\n        /* eslint-disable */\n        (function(name,path,ctx){var latest,prev=name!=='Keen'&&window.Keen?window.Keen:false;ctx[name]=ctx[name]||{ready:function(fn){var h=document.getElementsByTagName('head')[0],s=document.createElement('script'),w=window,loaded;s.onload=s.onerror=s.onreadystatechange=function(){if((s.readyState&&!(/^c|loade/.test(s.readyState)))||loaded){return}s.onload=s.onreadystatechange=null;loaded=1;latest=w.Keen;if(prev){w.Keen=prev}else{try{delete w.Keen}catch(e){w.Keen=void 0}}ctx[name]=latest;ctx[name].ready(fn)};s.async=1;s.src=path;h.parentNode.insertBefore(s,h)}}\n        })('KeenAsync','https://d26b395fwzu5fz.cloudfront.net/keen-tracking-1.4.2.min.js',this);\n\n        KeenAsync.ready(function(){\n            self.client = new KeenAsync({\n                projectId: projectId,\n                writeKey: writeKey\n            });\n            dfd.resolve(tracker);\n        });\n        /* eslint-enable */\n        return dfd;\n    };\n\n    tracker.loadTracker = function(trackerInfo) {\n        tracker.trackerInfo = trackerInfo;\n        return self.addKeenIO();\n    };\n\n    tracker.identify = function() {\n        self.client.recordEvent('identify', {\n            userHash: tracker.trackerInfo.staticShares.userHash\n        });\n    };\n\n    tracker.trackPage = function() {\n        self.client.recordEvent('pageviews', tracker.trackerInfo.staticShares);\n    };\n\n    tracker.processEvent = function(dfd, metricName, data) {\n        self.client.recordEvent(metricName, {\n            userHash: tracker.trackerInfo.staticShares.userHash,\n            eventData: data,\n        }, function() {\n            dfd.resolve(true);\n            Log.debug('KeenIO resolved.');\n        });\n    };\n\n    return tracker;\n});\n"],"names":["define","$","Log","self","this","tracker","addKeenIO","name","ctx","latest","prev","dfd","Deferred","writeKey","trackerInfo","projectId","window","Keen","ready","fn","loaded","h","document","getElementsByTagName","s","createElement","w","onload","onerror","onreadystatechange","readyState","test","e","async","src","parentNode","insertBefore","KeenAsync","client","resolve","debug","loadTracker","identify","recordEvent","userHash","staticShares","trackPage","processEvent","metricName","data","eventData"],"mappings":";;;;;;AAqBAA,oCAAO,CAAC,SAAS,aACjB,SAASC,EAAGC,SAEJC,KAAOC,KAEPC,QAAU,UAEdF,KAAKG,UAAY,eAQHC,KAAUC,IAASC,OAAOC,KAPhCC,IAAMV,EAAEW,WACRC,SAAWR,QAAQS,YAAYD,SAAUE,UAAYV,QAAQS,YAAYC,aACxEF,UAAaE,iBAKRR,KACP,YADiBC,IAC8DJ,KAD9CM,OAAoBM,OAAOC,MAAKD,OAAOC,KAAWT,IAAID,MAAMC,IAAID,OAAO,CAACW,MAAM,SAASC,QAA+FC,OAAvFC,EAAEC,SAASC,qBAAqB,QAAQ,GAAGC,EAAEF,SAASG,cAAc,UAAUC,EAAEV,OAAcQ,EAAEG,OAAOH,EAAEI,QAAQJ,EAAEK,mBAAmB,gBAAeL,EAAEM,aAAc,WAAWC,KAAKP,EAAEM,aAAeV,YAAeI,EAAEG,OAAOH,EAAEK,mBAAmB,KAAKT,OAAO,EAAEX,OAAOiB,EAAET,KAAQP,KAAMgB,EAAET,KAAKP,qBAAqBgB,EAAET,KAAK,MAAMe,GAAGN,EAAET,UAAK,EAAQT,IAAID,MAAME,OAAOD,IAAID,MAAMW,MAAMC,MAAKK,EAAES,MAAM,EAAET,EAAEU,IACzf,mEADkgBb,EAAEc,WAAWC,aAAaZ,EAAEH,KAG7iBgB,UAAUnB,OAAM,WACZf,KAAKmC,OAAS,IAAID,UAAU,CACxBtB,UAAWA,UACXF,SAAUA,WAEdF,IAAI4B,QAAQlC,YAGTM,IAfHT,IAAIsC,MAAM,gFAkBlBnC,QAAQoC,YAAc,SAAS3B,oBAC3BT,QAAQS,YAAcA,YACfX,KAAKG,aAGhBD,QAAQqC,SAAW,WACfvC,KAAKmC,OAAOK,YAAY,WAAY,CAChCC,SAAUvC,QAAQS,YAAY+B,aAAaD,YAInDvC,QAAQyC,UAAY,WAChB3C,KAAKmC,OAAOK,YAAY,YAAatC,QAAQS,YAAY+B,eAG7DxC,QAAQ0C,aAAe,SAASpC,IAAKqC,WAAYC,MAC7C9C,KAAKmC,OAAOK,YAAYK,WAAY,CAChCJ,SAAUvC,QAAQS,YAAY+B,aAAaD,SAC3CM,UAAWD,OACZ,WACCtC,IAAI4B,SAAQ,GACZrC,IAAIsC,MAAM,wBAIXnC"}