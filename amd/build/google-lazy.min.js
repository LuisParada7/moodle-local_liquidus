/**
 * Loads Segment tracker.
 *
 * @copyright Copyright (c) 2020 Open LMS
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_liquidus/google-lazy",["jquery","core/log","core/templates"],(function($,Log,Templates){var self=this,tracker={};return self.addAnalyticsJS=function(){var dfd=$.Deferred(),siteid=tracker.trackerInfo.siteid,lengthgid=siteid.length,courseId=tracker.trackerInfo.staticShares.courseId;if(void 0===courseId&&(courseId=siteid[0]),siteid){var context=[];context.siteid=siteid[0],context.courseId=courseId,context.gacodes=[],context.uacodes=[];for(var count=0;count<lengthgid;count++)"G-"===siteid[count].substring(0,2)?context.gacodes.push(siteid[count]):context.uacodes.push(siteid[count]);return Templates.render("local_liquidus/gtag",context).then((function(html){$("body").append(html),"undefined"!=typeof gtag?(self.gtag=gtag,dfd.resolve()):dfd.fail()})),dfd}Log.debug("Liquidus is misconfigured for Google, Site ID is missing.")},tracker.loadTracker=function(trackerInfo){return tracker.trackerInfo=trackerInfo,self.addAnalyticsJS()},tracker.identify=function(){},tracker.trackPage=function(){if(tracker.trackerInfo.staticShares.plugins){const plugins=tracker.trackerInfo.staticShares.plugins;Object.entries(plugins).forEach((_ref=>{let[type,value]=_ref;value.forEach((pluginId=>{const eventId=type+"_"+pluginId;self.gtag("event",eventId,{event_category:"pluginUsed"})}))})),delete tracker.trackerInfo.staticShares.plugins}if(tracker.trackerInfo.staticShares.userRole){const userRole=tracker.trackerInfo.staticShares.userRole;self.gtag("event",userRole.join(","),{event_category:"userRole"}),delete tracker.trackerInfo.staticShares.userRole}Object.entries(tracker.trackerInfo.staticShares).forEach((_ref2=>{let[eventCategory,eventId]=_ref2;self.gtag("event",eventId,{event_category:eventCategory})}))},tracker.processEvent=function(dfd,metricName,data){self.gtag("event",metricName,{userHash:tracker.trackerInfo.staticShares.userHash,eventData:data,event_callback:function(){dfd.resolve()}})},tracker}));

//# sourceMappingURL=google-lazy.min.js.map