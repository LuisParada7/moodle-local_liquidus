{"version":3,"file":"kinesis-lazy.min.js","sources":["../src/kinesis-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads AWS Kinesis tracker.\n *\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/log'],\nfunction($, Log) {\n\n    var self = this;\n\n    var tracker = {};\n\n    self.addAnalyticsJS = function() {\n        var dfd = $.Deferred();\n        if (!tracker.trackerInfo.kinesisURL) {\n            Log.debug('Liquidus is misconfigured for AWS Kinesis, Kinesis URL is missing.');\n            return null;\n        }\n\n        dfd.resolve(true);\n\n        return dfd;\n    };\n\n    tracker.loadTracker = function(trackerInfo) {\n        tracker.trackerInfo = trackerInfo;\n        return self.addAnalyticsJS();\n    };\n\n    tracker.identify = function() {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: tracker.trackerInfo.staticShares\n        }).done(function() {\n            Log.debug('Liquidus identified with kinesis.');\n        });\n    };\n\n    tracker.trackPage = function() {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: {\n                userHash: tracker.trackerInfo.staticShares.userHash,\n                page: window.location.pathname.split(\"/\").slice(-1),\n                referrer_page: document.referrer,\n                custom_metric_name: \"userAgent\",\n                custom_metric_string_value: navigator.userAgent,\n            }\n        }).done(function() {\n            Log.debug('Liquidus sent page to kinesis.');\n        });\n    };\n\n    tracker.heartBeat = function() {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: {\n                userHash: tracker.trackerInfo.staticShares.userHash,\n                custom_metric_name: \"heartBeat\",\n                custom_metric_string_value: 1,\n            }\n        }).done(function() {\n            Log.debug('Liquidus sent heart beat to kinesis.');\n        });\n    };\n\n    tracker.processEvent = function(dfd, metricName, data) {\n        $.ajax({\n            url: tracker.trackerInfo.kinesisURL,\n            method: 'POST',\n            headers: {\n                userHash: tracker.trackerInfo.staticShares.userHash,\n                custom_metric_name: metricName,\n                custom_metric_string_value: JSON.stringify(data),\n            }\n        }).done(function() {\n            dfd.resolve(true);\n            Log.debug('AWS Kinesis promise resolved.');\n        });\n    };\n\n    return tracker;\n});\n"],"names":["define","$","Log","self","this","tracker","addAnalyticsJS","dfd","Deferred","trackerInfo","kinesisURL","resolve","debug","loadTracker","identify","ajax","url","method","headers","staticShares","done","trackPage","userHash","page","window","location","pathname","split","slice","referrer_page","document","referrer","custom_metric_name","custom_metric_string_value","navigator","userAgent","heartBeat","processEvent","metricName","data","JSON","stringify"],"mappings":";;;;;;AAqBAA,qCAAO,CAAC,SAAU,aAClB,SAASC,EAAGC,SAEJC,KAAOC,KAEPC,QAAU,UAEdF,KAAKG,eAAiB,eACdC,IAAMN,EAAEO,kBACPH,QAAQI,YAAYC,YAKzBH,IAAII,SAAQ,GAELJ,MANHL,IAAIU,MAAM,sEACH,OAQfP,QAAQQ,YAAc,SAASJ,oBAC3BJ,QAAQI,YAAcA,YACfN,KAAKG,kBAGhBD,QAAQS,SAAW,WACfb,EAAEc,KAAK,CACHC,IAAKX,QAAQI,YAAYC,WACzBO,OAAQ,OACRC,QAASb,QAAQI,YAAYU,eAC9BC,MAAK,WACJlB,IAAIU,MAAM,yCAIlBP,QAAQgB,UAAY,WAChBpB,EAAEc,KAAK,CACHC,IAAKX,QAAQI,YAAYC,WACzBO,OAAQ,OACRC,QAAS,CACLI,SAAUjB,QAAQI,YAAYU,aAAaG,SAC3CC,KAAMC,OAAOC,SAASC,SAASC,MAAM,KAAKC,OAAO,GACjDC,cAAeC,SAASC,SACxBC,mBAAoB,YACpBC,2BAA4BC,UAAUC,aAE3Cf,MAAK,WACJlB,IAAIU,MAAM,sCAIlBP,QAAQ+B,UAAY,WAChBnC,EAAEc,KAAK,CACHC,IAAKX,QAAQI,YAAYC,WACzBO,OAAQ,OACRC,QAAS,CACLI,SAAUjB,QAAQI,YAAYU,aAAaG,SAC3CU,mBAAoB,YACpBC,2BAA4B,KAEjCb,MAAK,WACJlB,IAAIU,MAAM,4CAIlBP,QAAQgC,aAAe,SAAS9B,IAAK+B,WAAYC,MAC7CtC,EAAEc,KAAK,CACHC,IAAKX,QAAQI,YAAYC,WACzBO,OAAQ,OACRC,QAAS,CACLI,SAAUjB,QAAQI,YAAYU,aAAaG,SAC3CU,mBAAoBM,WACpBL,2BAA4BO,KAAKC,UAAUF,SAEhDnB,MAAK,WACJb,IAAII,SAAQ,GACZT,IAAIU,MAAM,qCAIXP"}