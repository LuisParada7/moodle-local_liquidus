/**
 * Loads Segment tracker.
 *
 * @copyright Copyright (c) 2020 Open LMS
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_liquidus/keenio-lazy",["jquery","core/log"],(function($,Log){var self=this,tracker={};return self.addKeenIO=function(){var name,ctx,latest,prev,dfd=$.Deferred(),writeKey=tracker.trackerInfo.writeKey,projectId=tracker.trackerInfo.projectId;if(writeKey&&projectId)return name="KeenAsync",ctx=this,prev=!!window.Keen&&window.Keen,ctx[name]=ctx[name]||{ready:function(fn){var loaded,h=document.getElementsByTagName("head")[0],s=document.createElement("script"),w=window;s.onload=s.onerror=s.onreadystatechange=function(){if(!(s.readyState&&!/^c|loade/.test(s.readyState)||loaded)){if(s.onload=s.onreadystatechange=null,loaded=1,latest=w.Keen,prev)w.Keen=prev;else try{delete w.Keen}catch(e){w.Keen=void 0}ctx[name]=latest,ctx[name].ready(fn)}},s.async=1,s.src="https://d26b395fwzu5fz.cloudfront.net/keen-tracking-1.4.2.min.js",h.parentNode.insertBefore(s,h)}},KeenAsync.ready((function(){self.client=new KeenAsync({projectId:projectId,writeKey:writeKey}),dfd.resolve(tracker)})),dfd;Log.debug("Liquidus is misconfigured for keen.io, Write Key or Project ID are missing.")},tracker.loadTracker=function(trackerInfo){return tracker.trackerInfo=trackerInfo,self.addKeenIO()},tracker.identify=function(){self.client.recordEvent("identify",{userHash:tracker.trackerInfo.staticShares.userHash})},tracker.trackPage=function(){self.client.recordEvent("pageviews",tracker.trackerInfo.staticShares)},tracker.processEvent=function(dfd,metricName,data){self.client.recordEvent(metricName,{userHash:tracker.trackerInfo.staticShares.userHash,eventData:data},(function(){dfd.resolve(!0),Log.debug("KeenIO resolved.")}))},tracker}));

//# sourceMappingURL=keenio-lazy.min.js.map