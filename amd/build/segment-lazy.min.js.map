{"version":3,"file":"segment-lazy.min.js","sources":["../src/segment-lazy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Loads Segment tracker.\n *\n * @copyright Copyright (c) 2020 Open LMS\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/log'],\nfunction($, Log) {\n\n    var self = this;\n\n    var tracker = {};\n\n    var options = {};\n\n    self.addAnalyticsJS = function() {\n        var dfd = $.Deferred();\n        var writeKey = tracker.trackerInfo.writeKey;\n        if (!writeKey) {\n            Log.debug('Liquidus is misconfigured for Segment, Write Key is missing.');\n            return;\n        }\n        /* eslint-disable */\n        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error(\"Segment snippet included twice.\");else{analytics.invoked=!0;analytics.methods=[\"trackSubmit\",\"trackClick\",\"trackLink\",\"trackForm\",\"pageview\",\"identify\",\"reset\",\"group\",\"track\",\"ready\",\"alias\",\"debug\",\"page\",\"once\",\"off\",\"on\"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement(\"script\");n.type=\"text/javascript\";n.async=!0;n.src=\"https://cdn.segment.com/analytics.js/v1/\"+t+\"/analytics.min.js\";var a=document.getElementsByTagName(\"script\")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics.SNIPPET_VERSION=\"4.1.0\";\n            self.analytics = analytics;\n            analytics.load(writeKey);\n            dfd.resolve(tracker);\n        }}();\n        /* eslint-enable */\n        return dfd;\n    };\n\n    tracker.loadTracker = function(trackerInfo) {\n        tracker.trackerInfo = trackerInfo;\n        return self.addAnalyticsJS();\n    };\n\n    tracker.identify = function() {\n        Log.debug('Identifying with segment');\n        self.analytics.identify(tracker.trackerInfo.staticShares.userHash, tracker.trackerInfo.staticShares);\n    };\n\n    tracker.trackPage = function() {\n        self.analytics.page();\n    };\n\n    tracker.processEvent = function(dfd, metricName, data) {\n        self.analytics.track(metricName, {\n            userHash: tracker.trackerInfo.staticShares.userHash,\n            eventData: data\n        }, options, function() {\n            dfd.resolve(true);\n            Log.debug('Segment resolved.');\n        });\n    };\n\n    return tracker;\n});\n"],"names":["define","$","Log","self","this","tracker","options","addAnalyticsJS","dfd","Deferred","writeKey","trackerInfo","analytics","window","initialize","invoked","console","error","methods","factory","t","e","Array","prototype","slice","call","arguments","unshift","push","length","load","n","document","createElement","type","async","src","a","getElementsByTagName","parentNode","insertBefore","_loadOptions","SNIPPET_VERSION","resolve","debug","loadTracker","identify","staticShares","userHash","trackPage","page","processEvent","metricName","data","track","eventData"],"mappings":";;;;;;AAqBAA,qCAAO,CAAC,SAAS,aACjB,SAASC,EAAGC,SAEJC,KAAOC,KAEPC,QAAU,GAEVC,QAAU,UAEdH,KAAKI,eAAiB,eACdC,IAAMP,EAAEQ,WACRC,SAAWL,QAAQM,YAAYD,YAC9BA,gBAKJ,eAAeE,UAAUC,OAAOD,UAAUC,OAAOD,WAAW,OAAOA,UAAUE,WAAW,GAAGF,UAAUG,QAAQF,OAAOG,SAASA,QAAQC,OAAOD,QAAQC,MAAM,uCAAuC,CAACL,UAAUG,SAAQ,EAAGH,UAAUM,QAAQ,CAAC,cAAc,aAAa,YAAY,YAAY,WAAW,WAAW,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ,OAAO,OAAO,MAAM,MAAMN,UAAUO,QAAQ,SAASC,UAAU,eAAeC,EAAEC,MAAMC,UAAUC,MAAMC,KAAKC,kBAAWL,EAAEM,QAAQP,GAAGR,UAAUgB,KAAKP,GAAUT,gBAAgB,IAAIQ,EAAE,EAAEA,EAAER,UAAUM,QAAQW,OAAOT,IAAI,KAAKC,EAAET,UAAUM,QAAQE,GAAGR,UAAUS,GAAGT,UAAUO,QAAQE,GAAGT,UAAUkB,KAAK,SAASV,EAAEC,OAAOU,EAAEC,SAASC,cAAc,UAAUF,EAAEG,KAAK,kBAAkBH,EAAEI,OAAM,EAAGJ,EAAEK,IAAI,2CAA2ChB,EAAE,wBAAwBiB,EAAEL,SAASM,qBAAqB,UAAU,GAAGD,EAAEE,WAAWC,aAAaT,EAAEM,GAAGzB,UAAU6B,aAAapB,GAAGT,UAAU8B,gBAAgB,QACp6BvC,KAAKS,UAAYA,UACjBA,UAAUkB,KAAKpB,UACfF,IAAImC,QAAQtC,UAHf,GAMMG,IAVHN,IAAI0C,MAAM,iEAalBvC,QAAQwC,YAAc,SAASlC,oBAC3BN,QAAQM,YAAcA,YACfR,KAAKI,kBAGhBF,QAAQyC,SAAW,WACf5C,IAAI0C,MAAM,4BACVzC,KAAKS,UAAUkC,SAASzC,QAAQM,YAAYoC,aAAaC,SAAU3C,QAAQM,YAAYoC,eAG3F1C,QAAQ4C,UAAY,WAChB9C,KAAKS,UAAUsC,QAGnB7C,QAAQ8C,aAAe,SAAS3C,IAAK4C,WAAYC,MAC7ClD,KAAKS,UAAU0C,MAAMF,WAAY,CAC7BJ,SAAU3C,QAAQM,YAAYoC,aAAaC,SAC3CO,UAAWF,MACZ/C,SAAS,WACRE,IAAImC,SAAQ,GACZzC,IAAI0C,MAAM,yBAIXvC"}