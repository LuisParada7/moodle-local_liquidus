/**
 * Loads Segment tracker.
 *
 * @copyright Copyright (c) 2020 Open LMS
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_liquidus/segment-lazy",["jquery","core/log"],(function($,Log){var self=this,tracker={},options={};return self.addAnalyticsJS=function(){var dfd=$.Deferred(),writeKey=tracker.trackerInfo.writeKey;if(writeKey)return function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0,analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);return e.unshift(t),analytics.push(e),analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a),analytics._loadOptions=e},analytics.SNIPPET_VERSION="4.1.0",self.analytics=analytics,analytics.load(writeKey),dfd.resolve(tracker)}}(),dfd;Log.debug("Liquidus is misconfigured for Segment, Write Key is missing.")},tracker.loadTracker=function(trackerInfo){return tracker.trackerInfo=trackerInfo,self.addAnalyticsJS()},tracker.identify=function(){Log.debug("Identifying with segment"),self.analytics.identify(tracker.trackerInfo.staticShares.userHash,tracker.trackerInfo.staticShares)},tracker.trackPage=function(){self.analytics.page()},tracker.processEvent=function(dfd,metricName,data){self.analytics.track(metricName,{userHash:tracker.trackerInfo.staticShares.userHash,eventData:data},options,(function(){dfd.resolve(!0),Log.debug("Segment resolved.")}))},tracker}));

//# sourceMappingURL=segment-lazy.min.js.map